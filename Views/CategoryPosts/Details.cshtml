@using Blog.Services
@using Blog.Models
@model CategoryPost
@inject IImageService imageService

@{
    ViewData["Title"] = "Details";
}

<article class="blog-post px-3 py-5 p-md-5">
    <div class="container text-center">
        <header class="blog-post-header">
            <h2 class="title mb-2">@Model.Title</h2>
            <h6 class="subheading">@Model.Abstract</h6>
            <div class="meta mb-3"><span class="date">Published on @Model.Created.ToString("MMMM dd, yyyy")</span></div>
        </header>

        <div class="blog-post-body">
            <figure class="blog-banner">
                <img src="@imageService.DecodeFile(Model.ImageData, Model.ContentType)" class="image-fluid">
            </figure>
            <p>@Html.Raw(Model.Content)</p>
        </div>
        @*<nav class="blog-nav nav nav-justified my-5">
                <a class="nav-link-prev nav-item nav-link rounded-left" href="#">Previous<i class="arrow-prev fas fa-long-arrow-alt-left"></i></a>
                <a class="nav-link-next nav-item nav-link rounded-right" href="#">Next<i class="arrow-next fas fa-long-arrow-alt-right"></i></a>
            </nav>*@

        <!--<div class="blog-comments-section">
            <div id="disqus_thread"></div>
            <script>

                        var disqus_config = function () {
                            // Replace PAGE_URL with your page's canonical URL variable
                            this.page.url = PAGE_URL;

                            // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                            this.page.identifier = PAGE_IDENTIFIER;
                        };
                        */

                        (function() {  // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
                            var d = document, s = d.createElement('script');

                            // IMPORTANT: Replace 3wmthemes with your forum shortname!
                            s.src = 'https://3wmthemes.disqus.com/embed.js';

                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
            </script>
            <noscript>
                Please enable JavaScript to view the
                <a href="https://disqus.com/?ref_noscript" rel="nofollow">
                    comments powered by Disqus.
                </a>
            </noscript>
        </div>-->

    </div><!--//container-->
    <br /><br />
    @if (User.Identity.IsAuthenticated)
    {
        <form asp-controller="Comments" asp-action="Create">
            <input type="hidden" asp-for="Slug" />
            <div class="container">
                <div class="row">
                    <div class="col-md">
                        @Html.Hidden("CategoryPostId", Model.Id)

                        <div class="form-group">
                            <label class="control-label">Comment</label>
                            @*<input asp-for="Body" class="form-control" />*@
                            <textarea required name="Body" class="form-control"></textarea>
                        </div>
                        <div class="form-group">
                            <input type="submit" value="Create" class="btn btn-success">
                        </div>
                    </div>
                </div>
            </div>
        </form>
    }
    else
    {
        <h5 class="text-center">Please <a asp-area="Identity" asp-page="/Account/Login">LOG IN </a>to add your comment!</h5>
    }
    <br /><br />
    @foreach (var comment in Model.Comments.OrderByDescending(c => c.Created))
    {
        <div class="row text-center">
            <div class="col">
                @comment.BlogUser.FullName
            </div>
            <div class="col">
                @comment.Created.ToString("MMMM dd, yyyy")
            </div>
        </div>
        @if (comment.HasBeenModerated)
        {
            <div class="row text-center">
                <div class="col">
                    @Html.Raw(comment.ModeratedBody)
                </div>
            </div>
        }
        else
        {
            <div class="row text-center">
                <div class="col">
                    @Html.Raw(comment.Body)
                </div>
            </div>
        }
    }
    <br />
    <div class="text-center">
        @if (User.IsInRole("Administrator"))
        {
            <a asp-action="Edit" asp-route-id="@Model.Id">Edit Post|</a>
        }
        @if (User.IsInRole("Administrator"))
        {
            <a asp-action="Delete" asp-route-id="@Model.Id">Delete Post|</a>
        }

        @if (User.IsInRole("Administrator"))
        {
            <a asp-controller="Comments" asp-action="Index" asp-route-id="@Model.Id">Edit Comment</a>
        }
        @if (User.IsInRole("Moderator"))
        {
            <a asp-controller="Comments" asp-action="Index" asp-route-id="@Model.Id">Edit Comment</a>
        } |
        <a asp-action="Index">Back to Posts</a>
    </div>
</article>
